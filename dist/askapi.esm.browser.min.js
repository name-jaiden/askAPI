/**
 * askApi v0.0.16
 * (c) 2019 Jaiden
 * @license MIT
 */
let t,e;const n={local(t,e,n){if("get"===t){return s(window.localStorage.getItem(e))}"set"===t&&(null===n?window.localStorage.removeItem(e):window.localStorage.setItem(e,JSON.stringify(n)))},session(t,e,n){if("get"===t){return s(window.sessionStorage.getItem(e))}"set"===t&&(null===n?window.sessionStorage.removeItem(e):window.sessionStorage.setItem(e,JSON.stringify(n)))},cookie(t,e,n){if("get"===t){if(!e)return"";let t="";const n=`${e}=`,i=document.cookie.indexOf(n);if(i>-1){let e=document.cookie.indexOf(";",i);-1===e&&(e=document.cookie.length),t=document.cookie.substring(i+n.length,e)}return s(t)}if("set"===t){let t="";const s=void 0===n&&null===n;t+=`${e}=${JSON.stringify(s?"":n)}`,document.cookie=t}}};function s(t){try{return null==t||""===t?void 0:JSON.parse(t)}catch(t){}}function i(t){return null!==t&&"object"==typeof t}function r(t,e){try{return t.split(".").reduce((t,e)=>t[e],e)}catch(t){}}function o(t,e){const n=t.split(".");return function(t,e,n){if(!i(e))return[];const s=[JSON.parse(JSON.stringify(e))],r=[];for(;s.length;){const e=s.shift();Object.entries(e).map(([n,o])=>{const a=e._targetPath_?`${e._targetPath_}.${n}`:n;n===t?r.push(a):i(o)&&(o._targetPath_=a,s.push(o))})}return n?function(t,e){return"string"==typeof e?(e="."===e.charAt(0)?e:`.${e}`,t.map(t=>t+e)):t}(r,n):r}(n.shift(),e,n.join(".")).map(t=>r(t,e)).filter(t=>void 0!==t).shift()}function a(t,e){if("function"!=typeof t)return e;const n=t(e);return void 0===n?e:n}class c{constructor({axiosConfig:n={},askConfig:s={}}){const r=function t(e){let n=e.apiPath&&e.method?{res:{},req:{}}:null;return Object.entries(e).forEach(([e,s])=>{if(i(s)){const i=t(s);i&&((n=n||{})[e]=i)}}),n}(s);this._config=s,this._axios=function({createDefaultConfig:t={},interceptors:n={}}){const s=e.create(t);if(0!==Object.keys(n).length){const t=t=>t,e=t=>Promise.reject(t),{request:i=t,response:r=t,errorRequest:o=e,errorResponse:a=e}=n;s.interceptors.request.use(i,o),s.interceptors.response.use(r,a)}return s}(n),this._watchVM=new t({data:{state:r}})}get state(){return this._watchVM.state}setState(e,s,i){const a=e.split("."),c=a.pop(),u=a.join(".")||c;let f;if("function"==typeof n[i]){const t=JSON.stringify(s);if(t===n[`_data${i}`])return;n[`_data${i}`]=t,n[i]("set",e,s)}if(/^state.*/.test(e)){if(!(f=r(u,this)))return function(e,n,s,i){return s.reduce((s,i)=>(e===i?t.set(s,i,n):t.set(s,i,{}),s[i]),i)}(c,s,a.slice(1).concat(c),this.state)}else(f=o(u,this.state))||c!==u||(f=this.state);t.set(f,c,s)}getState(t,e){if("function"==typeof n[e]){const s=n[e]("get",t);void 0!==s&&this.setState(t,s,e)}return/^state.*/.test(t)?r(t,this):o(t,this.state)}fetch(t,e){const{apiKey:n,mode:s}=function(t){return i(t)?t:"string"==typeof t?{apiKey:t}:{}}(t),{apiPath:r,method:c,mappingData:u,request:f,response:h}=o(n,this._config);if(null!==(e=a(f,e=function({apiPath:t,method:e,data:n}){const s="GET"===e.toUpperCase();return t.includes(":")&&s&&Object.entries(n).map(([e,s])=>{t=t.replace(new RegExp(`/:(${e})`,"g"),(t,e)=>delete n[e]&&`/${s}`)}),Object.assign({url:t,method:e},s?{params:n}:{data:n})}({apiPath:r,method:c,data:e=e||o(`${n}.req`,this.state)}))))return new Promise((t,r)=>{this._axios(e).then(e=>{i(u)&&(e=!0===u["%fetchMock"]?u:function(t,e){return Object.entries(t).map(([t,n])=>{if("string"==typeof n)return{[t]:o(n,e)};throw new Error(`the mapping requires a string, and the passing ${t} is a ${typeof n}`)}).reduce((t,e)=>Object.assign(t,e),{})}(u,e));const r=a(h,e);if(null===r)return t(e);this.setState(`${n}.res`,r,s),t(r)}).catch(e=>{if(!0===u["%fetchMock"]){const e=a(h,u);return this.setState(`${n}.res`,e,s),t(e)}return r(a(h,e))})})}}const u=(n,s)=>{e=s,(t=n).mixin({beforeCreate(){this.$options&&this.$options.askApi?this.$ask=this.$options.askApi:this.$ask=this.$parent&&this.$parent.$ask}})},f=t=>new c(t);export default{create:f,install:u,version:"0.0.16"};export{f as create,u as install};